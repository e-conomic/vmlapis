syntax = "proto3";

package ssn.mlservice.v1;

option go_package = "mlservice";

import "ssn/ocrservice/v1/ocrservice.proto";

// Machine learning Service
service MlService {
  rpc GetPrediction(MlRequest) returns (MlResponse);
}

message PredictedStringField {
  string value = 1;
  float confidence = 2;
  // The bounding box for the block.
  // The vertices are in the order of top-left, top-right, bottom-right,
  // bottom-left. When a rotation of the bounding box is detected the rotation
  // is represented as around the top-left corner as defined when the text is
  // read in the 'natural' orientation.
  // For example:
  //
  // * when the text is horizontal it might look like:
  //
  //         0----1
  //         |    |
  //         3----2
  //
  // * when it's rotated 180 degrees around the top-left corner it becomes:
  //
  //         2----3
  //         |    |
  //         1----0
  //
  //   and the vertex order will still be (0, 1, 2, 3).
  // google.cloud.vision.v1.BoundingPoly bounding_box = 3;

}

message PredictedFieldFloat {
  float value = 1;
  float confidence = 2;
  // google.cloud.vision.v1.BoundingPoly bounding_box = 3;

}

message Feature {
  enum Type {
    ORDER_DATE = 0;
    PAYMENT_DUE_DATE = 1;
    CURRENCY = 3;
    TOTAL_VAT = 4;
    TOTAL_INCL_VAT = 5;
    TOTAL_EXCL_VAT = 6;
    SUPPLIER_CORPORATE = 7;
    SUPPLIER_COUNTRY_CODE = 8;
    DOCUMENT_TYPE = 9;
    PAYMENT_METHOD = 10;
    CREDIT_CARD_NUMBER = 11;
    OCR_LINE = 12;
    INVOICE_NUMBER = 13;
  }
  Type type = 1;
  uint32 max_results = 2;
}

message MlRequest {
  repeated ssn.ocrservice.v1.OcrScanImageResponse ocr_responses = 1;
  string imageannotation = 2;
  repeated Feature features = 3;
}

message MlResponse {
  message OcrLineDk {
    // example: "71"
    PredictedStringField type = 1;
    // example: "000002879094031"
    PredictedStringField payment_id = 2;
    //example: "86570807"
    PredictedStringField creditor_id = 3;
  }
  message OcrLineSe {
    // example: "050765098"
    PredictedStringField payment_id = 1;
    // example: "2654507"
    PredictedStringField bankgiro_creditor_id = 2;
    // example: "5000872"
    PredictedStringField plusgiro_creditor_id = 3;
  }
  message OcrLineNo {
    // example: "12345678903"
    PredictedStringField payment_id = 1;
  }
  message OcrLineNl {
    // example: "0817937867870002"
    PredictedStringField payment_id = 1;
  }
  message OcrLineFi {
    // example: "00000159220010146012"
    PredictedStringField payment_id = 1;
  }
  // orderDate
  // ISO 8601 date string, ie. a string of the format "YYYY-MM-DD"
  // Example: "2019-12-31"
  repeated PredictedStringField order_date = 1;
  // paymentDueDate
  // ISO 8601 date, ie. a string of the format "YYYY-MM-DD"
  // Example: "2019-12-31"
  repeated PredictedStringField payment_due_date = 2;
  // currency
  // ISO 4217 string, ie. a 3-letter capitalized string
  // Example: "NOK"
  repeated PredictedStringField currency = 3;
  // totalVat
  // A string that parses as a two-decimal number
  // Example: "10.0" or "11.11"
  repeated PredictedFieldFloat total_vat = 4;
  // totalInclVat
  // A string that parses as a two-decimal number
  // Example: "10.0" or "11.11"
  repeated PredictedFieldFloat total_incl_vat = 5;
  // totalExclVat
  // A string that parses as a two-decimal number
  // Example: "10.0" or "11.11"
  repeated PredictedFieldFloat total_excl_vat = 6;
  // supplierCorporateId
  // The company VAT number
  // Example: "123456789B01" (for Dutch companies)
  // or "12345678" (for Norwegian companies)
  // Note: The field is repeated because multiple VAT numbers might exist.
  // If you have the VAT number of you customer, you can use this information
  // to find out which VAT number belongs to the supplier of the invoice.
  repeated PredictedStringField supplier_corporate_id = 7;
  // supplierCountryCode
  // ISO 3166-1 alpha-2 string, ei. a two-letter capitalized string
  // Example: "NO"
  repeated PredictedStringField supplier_country_code = 8;
  // documentType
  // Either "Receipt" or "Invoice"
  PredictedStringField document_type = 9;
  // paymentMethod
  // Either "Cash" or "CreditCard"
  PredictedStringField payment_method = 10;
  // creditCardNumber
  // Four digits
  // Example: "0012"
  repeated PredictedStringField credit_card_number = 11;
  // invoiceNumber
  // The supplier defined identifier af the invoice
  // Example: "12345-A99"
  repeated PredictedStringField invoice_number = 17;
  // Only one ocrLine will be present in a suggestion.
  oneof ocrLine {
    OcrLineDk ocr_line_dk = 12;
    OcrLineSe ocr_line_se = 13;
    OcrLineNo ocr_line_no = 14;
    OcrLineFi ocr_line_fi = 15;
    OcrLineNl ocr_line_nl = 16;
  }
}
